getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=E4805d16520de693a3fe707cdc962045')
url
}
getGeoData("富锦路地铁站","莘庄地铁站")
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
getGeoData("富锦路地铁站","莘庄地铁站")
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
readLines(url)
}
getGeoData("富锦路地铁站","莘庄地铁站")
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
readLines(url)
}
getGeoData("富锦路地铁站","莘庄地铁站")
url
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
read.table(url)
}
getGeoData("富锦路地铁站","莘庄地铁站")
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
getGeoData("富锦路地铁站","莘庄地铁站")
url = getGeoData("富锦路地铁站","莘庄地铁站")
browseURL(url)
cat(url)
library(stringr)
?stringr
str_conv("阿拉啦")
str_conv("阿拉啦","UTF-8")
str_conv("阿拉啦","GBK")
str_conv("阿拉啦","ASCII")
str_conv("阿拉啦","GB2312")
encodeString("As得分")
url
library(devtools)
install_github('badbye/baidumap')
browseURL(url)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
library(stringr)
url = getGeoData("富锦路地铁站","莘庄地铁站")
browseURL(url)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
library(stringr)
url = getGeoData("富锦路地铁站","莘庄地铁站")
browseURL(url)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
library(stringr)
url = getGeoData("富锦路地铁站","莘庄地铁站")
browseURL(url)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
url
}
library(stringr)
url = getGeoData("富锦路地铁站","莘庄地铁站")
browseURL(url)
library(XML)
htmlParse(url,encoding="UTF-8")
?rjson
library(rjson)
library(XML)
library(rjson)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
doc = htmlParse(url)
fromJSON(doc)
}
getGeoData("富锦路地铁站","莘庄地铁站")
doc
htmlParse(url)
rootNode<-xmlRoot(doc)
doc = htmlParse(url)
rootNode<-xmlRoot(doc)
xpathSApply(rootNode,"//p",xmlValue)
fromJSON(xpathSApply(rootNode,"//p",xmlValue))
library(XML)
library(rjson)
getGeoData = function(origin,destination,region = "上海"){
url = paste0(
'http://api.map.baidu.com/direction/v1?mode=transit&origin=',
origin,
'&destination=',
destination,
'&region=',
region,
'&output=json&ak=q9U1lWgCK1aBGVC1DVWrgWa7')
doc = htmlParse(url)
rootNode<-xmlRoot(doc)
fromJSON(xpathSApply(rootNode,"//p",xmlValue))
}
Line1_list = getGeoData("富锦路地铁站","莘庄地铁站")
Line1_list
Line1_list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Line1_list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path->Geo
strsplit(Geo,";")
Geo = strsplit(Geo,";")[1]
strsplit(Geo,",")
sapply(Geo, function(x) strsplit(x,","))
Gei
Geo
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
list = Line1_list
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo
class(Geo)
do.call(rbind,Geo)
names(Geo)
paste('Point',1:length(Geo))
names(Geo) = paste('Point',1:length(Geo))
Geo
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
names(Geo) = paste('Point',1:length(Geo))
Geo
row.names(Geo) = paste('Point',1:length(Geo))
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
row.names(Geo) = paste('Point',1:length(Geo))
class(Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = paste('Point',1:length(Geo))
row.names(Geo) = paste('Point',1:nrow(Geo))
Geo
cleanGeoData = function(list){
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = 1:nrow(Geo)
Geo$name = paste('Point',1:nrow(Geo))
pointDF = Geo
n = nrow(Geo)
nam = row.names(Geo)
lineDF = data.frame(origin = nam[1:n-1],
destination = nam[2:n])
return(list(pointDF,lineDF))
}
cleanGeoData(Line1_list)
cleanGeoData = function(list){
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = 1:nrow(Geo)
Geo$name = paste('Point',1:nrow(Geo))
pointDF = Geo
lineDF = data.frame(origin = Geo$name[1:nrow(Geo)-1],
destination = Geo$name[2:nrow(Geo)])
return(list(pointDF,lineDF))
}
cleanGeoData(Line1_list)
plot(Line1_list[[1]][,1],Line1_list[[1]][,2])
Line1_list[[1]][,2]
dat = cleanGeoData(Line1_list)
plot(dat[[1]][,1],dat[[1]][,2])
dat[[1]][,1]
cleanGeoData = function(list){
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = 1:nrow(Geo)
plyr::colwise(Geo)(as.numeric)
Geo$name = paste('Point',1:nrow(Geo))
pointDF = Geo
lineDF = data.frame(origin = Geo$name[1:nrow(Geo)-1],
destination = Geo$name[2:nrow(Geo)])
return(list(pointDF,lineDF))
}
dat = cleanGeoData(Line1_list)
cleanGeoData = function(list){
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = 1:nrow(Geo)
plyr::colwise(as.numeric)(Geo)
Geo$name = paste('Point',1:nrow(Geo))
pointDF = Geo
lineDF = data.frame(origin = Geo$name[1:nrow(Geo)-1],
destination = Geo$name[2:nrow(Geo)])
return(list(pointDF,lineDF))
}
dat = cleanGeoData(Line1_list)
plot(dat[[1]][,1],dat[[1]][,2])
dat[[1]][,1]
dat[[1]]
dat[[1]]$V1
as.numeric(dat[[1]]$V1)
cleanGeoData = function(list){
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo = strsplit(Geo,";")[[1]]
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo = as.data.frame(Geo)
row.names(Geo) = 1:nrow(Geo)
plyr::colwise(as.character)(Geo)
plyr::colwise(as.numeric)(Geo)
Geo$name = paste('Point',1:nrow(Geo))
pointDF = Geo
lineDF = data.frame(origin = Geo$name[1:nrow(Geo)-1],
destination = Geo$name[2:nrow(Geo)])
return(list(pointDF,lineDF))
}
dat = cleanGeoData(Line1_list)
plot(dat[[1]]$V1,dat[[1]][,2])
dat[[1]]$V1
Line1_list
Geo = list$result$routes[[1]]$scheme[[1]]$steps[[2]][[1]]$path
Geo
Geo = strsplit(Geo,";")[[1]]
Geo
Geo = sapply(Geo, function(x) strsplit(x,","))
Geo = do.call(rbind,Geo)
Geo
Geo = as.data.frame(Geo)
Geo
sapply(Geo,class)
row.names(Geo) = 1:nrow(Geo)
plot(as.numeric(as.character(dat[[1]]$V1)),
as.numeric(as.character(dat[[1]]$V2)))
as.numeric(as.character(dat[[1]]$V2)),"l")
plot(as.numeric(as.character(dat[[1]]$V1)),
as.numeric(as.character(dat[[1]]$V2)),"l")
points.default()
pointDF
list = dat
pointDF = list[[1]]
pointDF
sapply(pointDF,function(x) paste(x[3],x[1],x[2]))
apply(pointDF,1,function(x) paste(x[3],x[1],x[2]))
apply(pointDF,1,function(x)
paste0("'",x[3],"':[",x[1],",",x[2],"]"))
geoCoord = apply(pointDF,1,function(x)
paste0("'",x[3],"':[",x[1],",",x[2],"]"))
geoCoord = paste(geoCoord,collapse = "\n")
cat(geoCoord)
pointDF = list[[1]]
lineDF = list[[2]]
geoCoord = apply(pointDF,1,function(x)
paste0("'",x[3],"':[",x[1],",",x[2],"]"))
geoCoord = paste(geoCoord,collapse = ",\n")
cat(geoCoord)
markLine = apply(lineDF,1,function(x)
paste0("[{name:'",x[1],"'}, {name:'",x[2],
",value:40}]" ))
markLine = paste(markLine,collapse = ",\n")
cat(markLine)
markpoint = apply(pointDF,1,function(x)
paste0("{name:'",x[3],",value:90}"))
markpoint = paste(markpoint,collapse = ",\n")
cat(markpoint)
con2echarts = function(list){
pointDF = list[[1]]
lineDF = list[[2]]
geoCoord = apply(pointDF,1,function(x)
paste0("'",x[3],"':[",x[1],",",x[2],"]"))
geoCoord = paste(geoCoord,collapse = ",\n")
markLine = apply(lineDF,1,function(x)
paste0("[{name:'",x[1],"'}, {name:'",x[2],
",value:40}]" ))
markLine = paste(markLine,collapse = ",\n")
markpoint = apply(pointDF,1,function(x)
paste0("{name:'",x[3],",value:90}"))
markpoint = paste(markpoint,collapse = ",\n")
return(list(geoCoord,markLine,markpoint))
}
list = con2echarts(dat)
list
sapply(list,cat)
cat(list[[1]])
cat(list[[2]])
con2echarts = function(list){
pointDF = list[[1]]
lineDF = list[[2]]
geoCoord = apply(pointDF,1,function(x)
paste0("'",x[3],"':[",x[1],",",x[2],"]"))
geoCoord = paste(geoCoord,collapse = ",\n")
markLine = apply(lineDF,1,function(x)
paste0("[{name:'",x[1],"'}, {name:'",x[2],
"',value:40}]" ))
markLine = paste(markLine,collapse = ",\n")
markpoint = apply(pointDF,1,function(x)
paste0("{name:'",x[3],"',value:90}"))
markpoint = paste(markpoint,collapse = ",\n")
return(list(geoCoord,markLine,markpoint))
}
list = con2echarts(dat)
cat(list[[1]])
cat(list[[2]])
cat(list[[3]])
paste0("[{name:'Point ",1:99,"'},\n[{name:'Point ")
paste0("{name:'Point ",1:99,"'}")
paste(paste0("{name:'Point ",1:99,"'}"),collapse = ",")
readHTMLTable("http://service.shmetro.com/hcskb/240.htm")
readHTMLTable("http://service.shmetro.com/hcskb/240.htm")->tab
names(tab)
tab[[1]]
input = "莘庄
外环路 	5:32 	6:02 	22:34 	23:32
莲花路 	5:34 	6:00 	22:36 	23:30
锦江乐园 	5:37 	5:57 	22:39 	23:27
上海南站 	4:55 	5:18 	5:54 	22:42 	23:24
漕宝路 	4:57 	5:20 	5:51 	22:45 	23:21
上海体育馆 	5:00 	5:23 	5:49 	22:48 	23:19
徐家汇 	5:02 	5:25 	5:46 	22:50 	23:16
衡山路 	5:04 	5:27 	5:44 	22:52 	23:14
常熟路 	5:06 	5:29 	5:42 	22:54 	23:12
陕西南路 	5:08 	5:31 	5:40 	22:56 	23:10
黄陂南路 	5:11 	5:34 	5:38 	22:58 	23:08
人民广场 	5:14 	5:37 	5:35 	23:01 	23:05
新闸路 	5:15 	5:38 	5:33 	23:03 	23:03
汉中路 	5:17 	5:40 	5:31 	23:05 	23:01
上海火车站 	5:19
(到达) 	5:43 	5:30 	23:08 	23:00
中山北路 	--- 	5:45 	5:57 	23:10 	22:57
延长路 	--- 	5:48 	5:55 	23:13 	22:55
上海马戏城 	--- 	5:50 	5:53 	23:15 	22:53
汶水路 	--- 	5:52 	5:50 	23:17 	22:50
彭浦新村 	--- 	5:55 	5:47 	23:20 	22:47
共康路 	--- 	5:58 	5:45 	23:23 	22:45
通河新村 	--- 	6:00 	5:42 	23:25 	22:42
呼兰路 	--- 	6:03 	5:40 	23:27 	22:40
共富新村 	--- 	6:05 	5:37 	23:30 	22:37
宝安公路 	--- 	6:08 	5:34 	23:33 	22:34
友谊西路 	--- 	6:10 	5:32 	23:35 	22:32
富 锦 路"
input = "莘庄
外环路 	5:32 	6:02 	22:34 	23:32
莲花路 	5:34 	6:00 	22:36 	23:30
锦江乐园 	5:37 	5:57 	22:39 	23:27
上海南站 	4:55 	5:18 	5:54 	22:42 	23:24
漕宝路 	4:57 	5:20 	5:51 	22:45 	23:21
上海体育馆 	5:00 	5:23 	5:49 	22:48 	23:19
徐家汇 	5:02 	5:25 	5:46 	22:50 	23:16
衡山路 	5:04 	5:27 	5:44 	22:52 	23:14
常熟路 	5:06 	5:29 	5:42 	22:54 	23:12
陕西南路 	5:08 	5:31 	5:40 	22:56 	23:10
黄陂南路 	5:11 	5:34 	5:38 	22:58 	23:08
人民广场 	5:14 	5:37 	5:35 	23:01 	23:05
新闸路 	5:15 	5:38 	5:33 	23:03 	23:03
汉中路 	5:17 	5:40 	5:31 	23:05 	23:01
上海火车站 	5:19
中山北路 	--- 	5:45 	5:57 	23:10 	22:57
延长路 	--- 	5:48 	5:55 	23:13 	22:55
上海马戏城 	--- 	5:50 	5:53 	23:15 	22:53
汶水路 	--- 	5:52 	5:50 	23:17 	22:50
彭浦新村 	--- 	5:55 	5:47 	23:20 	22:47
共康路 	--- 	5:58 	5:45 	23:23 	22:45
通河新村 	--- 	6:00 	5:42 	23:25 	22:42
呼兰路 	--- 	6:03 	5:40 	23:27 	22:40
共富新村 	--- 	6:05 	5:37 	23:30 	22:37
宝安公路 	--- 	6:08 	5:34 	23:33 	22:34
友谊西路 	--- 	6:10 	5:32 	23:35 	22:32
富 锦 路"
